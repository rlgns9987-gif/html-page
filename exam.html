<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë§¤ê²½í…ŒìŠ¤íŠ¸ ì‹¤ì „ ëª¨ì˜ê³ ì‚¬</title>
    <style>
        :root { --primary: #3498db; --secondary: #2c3e50; --bg: #f5f7f9; }
        body { font-family: 'Malgun Gothic', sans-serif; background-color: var(--bg); margin: 0; padding: 20px; color: #333; }
        .container { max-width: 850px; margin: 0 auto; background: #fff; padding: 40px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--primary); padding-bottom: 15px; margin-bottom: 30px; }
        .timer { font-size: 1.5em; font-weight: bold; color: #e74c3c; }
        .progress-container { width: 100%; background: #eee; height: 10px; border-radius: 5px; margin-bottom: 20px; overflow: hidden; }
        .progress-bar { background: var(--primary); height: 100%; width: 0%; transition: 0.3s; }
        .q-title { font-size: 1.3em; font-weight: bold; margin-bottom: 25px; line-height: 1.5; }
        .options { display: flex; flex-direction: column; gap: 12px; }
        .opt-btn { padding: 18px; border: 1px solid #ddd; border-radius: 10px; background: #fff; cursor: pointer; text-align: left; font-size: 1.1em; transition: 0.2s; outline: none; }
        .opt-btn:hover { background: #eef7ff; border-color: var(--primary); }
        .opt-btn.selected { background: var(--primary); color: white; border-color: var(--primary); }
        .nav-btns { display: flex; justify-content: space-between; margin-top: 40px; }
        .nav-btns button { padding: 12px 30px; border-radius: 5px; cursor: pointer; border: none; font-size: 1em; font-weight: bold; }
        .prev-btn { background: #95a5a6; color: white; }
        .next-btn { background: var(--primary); color: white; }
        .submit-btn { background: #27ae60; color: white; display: none; }
        #result-screen { display: none; text-align: center; }
        .score-circle { width: 150px; height: 150px; border-radius: 50%; border: 8px solid var(--primary); margin: 20px auto; display: flex; align-items: center; justify-content: center; font-size: 2.5em; font-weight: bold; }
        .wrong-list { text-align: left; margin-top: 30px; max-height: 400px; overflow-y: auto; padding: 15px; border: 1px solid #eee; }
        .wrong-item { margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px dashed #ccc; }
        .explanation { color: #666; font-size: 0.9em; background: #fdf9f2; padding: 10px; border-left: 3px solid #f1c40f; margin-top: 5px; }
    </style>
</head>
<body>

<div class="container" id="quiz-screen">
    <div class="header">
        <div><strong>ì‹¤ì „ ëª¨ì˜ê³ ì‚¬</strong> (80ë¬¸í•­)</div>
        <div class="timer" id="timer">80:00</div>
    </div>
    <div class="progress-container"><div class="progress-bar" id="progress-bar"></div></div>
    <div id="quiz-area">
        <div class="q-title" id="q-title"></div>
        <div class="options" id="options-area"></div>
    </div>
    <div class="nav-btns">
        <button class="prev-btn" onclick="prevQ()">ì´ì „</button>
        <div id="q-num-info" style="align-self: center;">1 / 80</div>
        <button class="next-btn" id="next-btn" onclick="nextQ()">ë‹¤ìŒ</button>
        <button class="submit-btn" id="submit-btn" onclick="showResults()">ìµœì¢… ì œì¶œ</button>
    </div>
</div>

<div class="container" id="result-screen">
    <h2>ì‹œí—˜ ê²°ê³¼</h2>
    <div class="score-circle" id="final-score">0ì </div>
    <p id="score-comment"></p>
    <hr>
    <h3>ì˜¤ë‹µ ë…¸íŠ¸ ë° í•´ì„¤</h3>
    <div class="wrong-list" id="wrong-list"></div>
    <button class="next-btn" onclick="location.reload()" style="margin-top:20px">ë‹¤ì‹œ í’€ê¸°</button>
</div>

<script>
    let allQuestions = [];
    let examData = [];     // ë³´ê¸°ê°€ ì´ë¯¸ ì„ì¸ ìƒíƒœë¡œ ì €ì¥ë  80ë¬¸ì œ
    let userAnswers = new Array(80).fill(null);
    let currentIdx = 0;
    let timeLeft = 80 * 60;

    async function loadDataAndInit() {
        try {
            const response = await fetch('./data.json'); 
            if (!response.ok) throw new Error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨');
            allQuestions = await response.json();
            initExam();
        } catch (error) {
            console.error(error);
            alert('data.json íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì„œë²„ í™˜ê²½ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.');
        }
    }

    function initExam() {
        // 1. ì „ì²´ 300ì œ ì¤‘ 80ê°œ ëœë¤ ì¶”ì¶œ
        const shuffledQuestions = [...allQuestions].sort(() => Math.random() - 0.5);
        const selected = shuffledQuestions.slice(0, 80);

        // 2. [ë§¤ìš° ì¤‘ìš”] ì‹œí—˜ ì‹œì‘ ì‹œ ë”± í•œ ë²ˆë§Œ ë³´ê¸°ë¥¼ ì„ì–´ì„œ ê³ ì •í•¨
        examData = selected.map(q => {
            // ì›ë³¸ ë³´ê¸°ì™€ ì •ë‹µ ì—¬ë¶€ë¥¼ ë§¤í•‘
            let optionsWithCorrectFlag = q.options.map((opt, idx) => ({
                text: opt,
                isCorrect: idx === q.answer
            }));
            
            // ë³´ê¸° ëœë¤ ì„ê¸°
            optionsWithCorrectFlag.sort(() => Math.random() - 0.5);

            // ì„ì¸ ë¦¬ìŠ¤íŠ¸ì—ì„œ ìƒˆë¡œìš´ ì •ë‹µ ì¸ë±ìŠ¤ ì°¾ê¸°
            const newAnswerIndex = optionsWithCorrectFlag.findIndex(o => o.isCorrect);

            return {
                ...q,
                options: optionsWithCorrectFlag.map(o => o.text), // ì„ì¸ í…ìŠ¤íŠ¸ ë°°ì—´
                answer: newAnswerIndex // ìƒˆë¡œ ê³ ì •ëœ ì •ë‹µ ë²ˆí˜¸
            };
        });

        renderQuestion();
        startTimer();
    }

    function renderQuestion() {
        const q = examData[currentIdx];
        document.getElementById('q-title').innerText = `Q${currentIdx + 1}. ${q.q}`;
        document.getElementById('q-num-info').innerText = `${currentIdx + 1} / 80`;
        
        const optionsArea = document.getElementById('options-area');
        optionsArea.innerHTML = '';

        // ì´ë¯¸ initExamì—ì„œ ì„ì—¬ì„œ ê³ ì •ëœ q.optionsë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•¨
        q.options.forEach((opt, i) => {
            const btn = document.createElement('button');
            btn.className = `opt-btn ${userAnswers[currentIdx] === i ? 'selected' : ''}`;
            btn.innerText = `${i + 1}. ${opt}`;
            btn.onclick = () => selectOption(i);
            optionsArea.appendChild(btn);
        });

        document.getElementById('progress-bar').style.width = `${((currentIdx + 1) / 80) * 100}%`;
        document.getElementById('next-btn').style.display = currentIdx === 79 ? 'none' : 'block';
        document.getElementById('submit-btn').style.display = currentIdx === 79 ? 'block' : 'none';
    }

    function selectOption(idx) {
        userAnswers[currentIdx] = idx;
        renderQuestion(); // ë Œë”ë§ì„ ë‹¤ì‹œ í•´ë„ ì´ë¯¸ ì„ì¸ examDataë¥¼ ì“°ë¯€ë¡œ ìˆœì„œ ì•ˆ ë°”ë€œ
    }

    function nextQ() { if (currentIdx < 79) { currentIdx++; renderQuestion(); } }
    function prevQ() { if (currentIdx > 0) { currentIdx--; renderQuestion(); } }

    function startTimer() {
        const timerEl = document.getElementById('timer');
        const interval = setInterval(() => {
            let mins = Math.floor(timeLeft / 60);
            let secs = timeLeft % 60;
            timerEl.innerText = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            if (timeLeft <= 0) {
                clearInterval(interval);
                showResults();
            }
            timeLeft--;
        }, 1000);
    }

    function showResults() {
        document.getElementById('quiz-screen').style.display = 'none';
        document.getElementById('result-screen').style.display = 'block';
        let score = 0;
        const wrongList = document.getElementById('wrong-list');
        wrongList.innerHTML = ''; // ë¦¬ìŠ¤íŠ¸ ì´ˆê¸°í™”

        examData.forEach((q, i) => {
            const isCorrect = userAnswers[i] === q.answer;
            if (isCorrect) score++;

            // ê²°ê³¼ í•­ëª© ìƒì„±
            const div = document.createElement('div');
            div.className = 'wrong-item';
            
            // ë§ì•˜ëŠ”ì§€ í‹€ë ¸ëŠ”ì§€ì— ë”°ë¼ ì•„ì´ì½˜ê³¼ ìƒ‰ìƒ ê²°ì •
            const statusIcon = isCorrect ? '<span style="color:#27ae60">âœ… ì •ë‹µ</span>' : '<span style="color:#e74c3c">âŒ ì˜¤ë‹µ</span>';
            const userChoice = userAnswers[i] !== null ? q.options[userAnswers[i]] : 'ë¯¸ë‹µë³€';
            const correctAnswer = q.options[q.answer];

            div.innerHTML = `
                <div style="margin-bottom: 5px;">${statusIcon} <strong>Q${i + 1}. ${q.q}</strong></div>
                <div style="font-size: 0.95em; margin-left: 20px;">
                    <span style="color:${isCorrect ? '#27ae60' : '#e74c3c'}">ë‚´ ì„ íƒ: ${userChoice}</span><br>
                    <span style="color:#3498db">ì •ë‹µ: ${correctAnswer}</span>
                </div>
                <div class="explanation">ğŸ’¡ í•´ì„¤: ${q.ext}</div>
            `;
            wrongList.appendChild(div);
        });

        const finalScore = Math.round((score / 80) * 1000);
        document.getElementById('final-score').innerText = `${finalScore}ì `;
        
        let comment = finalScore >= 600 ? "ì¶•í•˜í•©ë‹ˆë‹¤! í•©ê²©ê¶Œì…ë‹ˆë‹¤." : "ìœ„ë“œì—ë“€ ìë£Œë¡œ ì¡°ê¸ˆ ë” ë³µìŠµí•´ ë³´ì„¸ìš”.";
        document.getElementById('score-comment').innerText = comment;
    }

    window.onload = loadDataAndInit;
</script>
</body>
</html>